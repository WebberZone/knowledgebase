!function(t){"use strict";var o=0,i={},a=-1;function r(o,i){t("#wzkb-migration-progress-bar").css("width",o+"%"),t("#wzkb-migration-progress-bar").html(o+"%"),t("#wzkb-migration-progress-text").html(i)}function n(o){t("#wzkb-migration-errors").append("<li>"+o+"</li>")}function s(o){if(o){var i=(new Date).toLocaleString(),a=t("#wzkb-migration-log");a.append("<p><strong>["+i+"]</strong> "+o+"</p>"),a.scrollTop(a[0].scrollHeight),setTimeout((function(){a[0].offsetHeight}),0)}}function e(){var d=JSON.parse(JSON.stringify(i));void 0!==d.current_top_section_index&&d.current_top_section_index===a?(window.wzkbMigrationLoopCount||(window.wzkbMigrationLoopCount=0),window.wzkbMigrationLoopCount++,window.wzkbMigrationLoopCount>=5&&(window.wzkbMigrationLoopCount=0)):window.wzkbMigrationLoopCount=0,a=d.current_top_section_index,t.ajax({url:ajaxurl,method:"POST",data:{action:"wzkb_product_migration_batch",_nonce:wzkbProductMigrator.nonce,step:o,dry_run:t("#wzkb-dry-run").is(":checked")?1:0,state:d},success:function(a){return a.success?(a.data.log&&Array.isArray(a.data.log)&&a.data.log.forEach((function(t){s(t)})),a.data.message&&s(a.data.message),a.data.progress&&r(a.data.progress,a.data.message),a.data.errors&&a.data.errors.length&&a.data.errors.forEach(n),a.data.dry_run&&a.data.done?(r(100,a.data.message),void t("#wzkb-migration-start").prop("disabled",!1)):a.data.done?(r(100,a.data.message||wzkbProductMigrator.strings.migration_complete),void t("#wzkb-migration-start").prop("disabled",!1)):(o=a.data.next_step,i=JSON.parse(JSON.stringify(a.data.state)),void setTimeout(e,100))):(n(a.data||wzkbProductMigrator.strings.unknown_error),r(100,wzkbProductMigrator.strings.migration_failed),void t("#wzkb-migration-start").prop("disabled",!1))},error:function(o,i,a){n(wzkbProductMigrator.strings.ajax_error+": "+a),r(100,wzkbProductMigrator.strings.migration_failed),t("#wzkb-migration-start").prop("disabled",!1)}})}t(document).ready((function(){t("#wzkb-migration-start").prop("disabled",!0),t("#wzkb-backup-confirm").on("change",(function(){t("#wzkb-migration-start").prop("disabled",!this.checked)})),t("#wzkb-migration-start").on("click",(function(n){n.preventDefault(),o=0,i={},a=-1,t("#wzkb-migration-progress-bar").css("width","0%"),t("#wzkb-migration-progress-text").html(""),t("#wzkb-migration-errors").empty(),t("#wzkb-migration-log").empty(),t(this).prop("disabled",!0),r(0,wzkbProductMigrator.strings.starting_migration),e()})),t("#wzkb-copy-log").on("click",(function(){var o=t(this),i=t("#wzkb-migration-log"),a="";if(i.find("p").each((function(){a+=t(this).text()+"\n\n"})),!(a=a.trim()))return o.html('<span class="dashicons dashicons-warning"></span> Empty Log'),void setTimeout((function(){o.html('<span class="dashicons dashicons-clipboard" style="margin-right:5px;"></span> Copy Log')}),2e3);navigator.clipboard.writeText(a).then((function(){o.html('<span class="dashicons dashicons-yes"></span> Copied!'),setTimeout((function(){o.html('<span class="dashicons dashicons-clipboard" style="margin-right:5px;"></span> Copy Log')}),2e3)})).catch((function(t){o.html('<span class="dashicons dashicons-no"></span> Failed!'),setTimeout((function(){o.html('<span class="dashicons dashicons-clipboard" style="margin-right:5px;"></span> Copy Log')}),2e3)}))}))}))}(jQuery);